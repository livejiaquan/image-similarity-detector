# ğŸ“Œ åœ–ç‰‡ç›¸ä¼¼åº¦æª¢æ¸¬å·¥å…·

## **1. å°ˆæ¡ˆç°¡ä»‹**
æœ¬å·¥å…·åŸºæ–¼ **ResNet50 æ·±åº¦å­¸ç¿’æ¨¡å‹**ï¼Œå¯ç”¨æ–¼æª¢æ¸¬è³‡æ–™å¤¾å…§çš„ **ç›¸ä¼¼åœ–ç‰‡**ï¼Œé©ç”¨æ–¼å»é‡ (Deduplication)ã€ç›£æ§å½±åƒæ¯”å°ã€æ•¸æ“šé›†æ¨™è¨»æª¢æŸ¥ç­‰å ´æ™¯ã€‚

## **2. ä¸»è¦åŠŸèƒ½**
- **åœ–ç‰‡ç‰¹å¾µæå–**ï¼šä½¿ç”¨ ResNet50 é€²è¡Œç‰¹å¾µå‘é‡æŠ½å–ã€‚
- **ç›¸ä¼¼åº¦è¨ˆç®—**ï¼šåŸºæ–¼ **Cosine Similarity** è¨ˆç®—åœ–ç‰‡ç›¸ä¼¼åº¦ã€‚
- **ç›¸ä¼¼åœ–ç‰‡ç¯©é¸**ï¼šä½¿ç”¨ **é–¾å€¼ (Threshold)** éæ¿¾ç›¸ä¼¼åœ–ç‰‡å°ã€‚
- **æ¯”å°æ¨¡å¼**ï¼š
  - `all`ï¼šæ¯”å°æ‰€æœ‰åœ–ç‰‡ã€‚
  - `inter_folder`ï¼šåƒ…é€²è¡Œè·¨è³‡æ–™å¤¾æ¯”å°ã€‚
- **è¼¸å‡ºçµæœ**ï¼šç”Ÿæˆ **ç›¸ä¼¼åœ–ç‰‡å° JSON å ±å‘Š**ï¼Œä¸¦ **å¯é¸æ“‡æ‹¼æ¥åœ–ç‰‡è¼¸å‡º**ã€‚

## **3. ä½¿ç”¨æ–¹å¼**

### **ğŸ“Œ 3.1 è¨­å®šåƒæ•¸ï¼ˆæ–¼ `main()` å…§èª¿æ•´ï¼‰**

| åƒæ•¸åç¨± | èªªæ˜ | é è¨­å€¼ |
|----------|---------------------------------|-------|
| `folder_list` | æ¬²æƒæçš„åœ–ç‰‡è³‡æ–™å¤¾ | `['CCTVforSora/']` |
| `threshold` | **ç›¸ä¼¼åº¦é–¾å€¼** (å€¼è¶Šé«˜åŒ¹é…è¶Šåš´æ ¼) | `0.99` |
| | **èªªæ˜**ï¼šè‹¥ç‚º **å» å€éœæ…‹ CCTV å ´æ™¯** (èƒŒæ™¯ç›¸åŒ)ï¼Œå¯è¨­ç½® **0.99**ï¼Œç¢ºä¿åƒ…åµæ¸¬é«˜åº¦ç›¸ä¼¼åœ–ç‰‡ã€‚ |
| `compare_mode` | æ¯”å°æ¨¡å¼ (`full` or `sample`) | `full` |
| `sample_ratio` | `sample` æ¨¡å¼ä¸‹çš„æŠ½æ¨£æ¯”ä¾‹ | `0.3` (30%) |
| `compare_scope` | `all` (å…¨éƒ¨æ¯”å°) or `inter_folder` (è·¨è³‡æ–™å¤¾æ¯”å°) | `all` |
| `max_pairs_for_collage` | ç”Ÿæˆæ‹¼æ¥åœ–æ™‚ï¼Œæœ€å¤šé¡¯ç¤ºå¹¾çµ„ | `20` |

### **ğŸ“Œ 3.2 åŸ·è¡Œç¨‹å¼**
```bash
python main.py
```

## **4. è¼¸å‡ºçµæœ**

### **ğŸ“Œ 4.1 çµ‚ç«¯æ©Ÿè¼¸å‡ºç¯„ä¾‹**
```bash
Total images found: 1500
Threshold = 0.99
Found 235 pairs of images that meet the similarity threshold.
Number of unique groups: 1200
Photos that can be removed if only keeping 1 from each group: 300
Collage saved: results/20250219_123456/similar_pairs_sample/random_collage.jpg
Result JSON: results/20250219_123456/report.json
Done. Output folder: results/20250219_123456
```

### **ğŸ“Œ 4.2 ç”¢å‡ºå ±å‘Šçµæ§‹**
```
results/
â”‚â”€â”€ 20250219_123456/  â† (æœ¬æ¬¡é‹è¡Œè¼¸å‡º)
â”‚   â”œâ”€â”€ report.json  â† (ç›¸ä¼¼åœ–ç‰‡ JSON å ±å‘Š)
â”‚   â”œâ”€â”€ similar_pairs_sample/  
â”‚   â”‚   â”œâ”€â”€ random_collage.jpg  â† (éš¨æ©Ÿç›¸ä¼¼åœ–ç‰‡æ‹¼æ¥åœ–)
```

### **ğŸ“Œ 4.3 JSON å ±å‘Šæ ¼å¼ç¯„ä¾‹**
```json
{
    "timestamp": "20250219_123456",
    "folder_list": ["CCTVforSora"],
    "total_images_in_folders": 1500,
    "compare_mode": "full",
    "threshold": 0.99,
    "number_of_similar_pairs": 235,
    "number_of_unique_groups": 1200,
    "photos_to_remove": 300,
    "similar_pairs": [
        {
            "index": 1,
            "image1": "CCTVforSora/img1.jpg",
            "image2": "CCTVforSora/img2.jpg",
            "similarity_score": 0.9956
        },
        {
            "index": 2,
            "image1": "CCTVforSora/img3.jpg",
            "image2": "CCTVforSora/img4.jpg",
            "similarity_score": 0.9923
        }
    ]
}
```

æ­¤å ±å‘Šè©³ç´°è¨˜éŒ„äº†ï¼š
- **æ‰¾åˆ°çš„ç›¸ä¼¼åœ–ç‰‡å°**
- **å°æ‡‰ç›¸ä¼¼åº¦åˆ†æ•¸**
- **è‹¥åˆªé™¤é‡è¤‡åœ–ç‰‡ï¼Œæœ€å¤šå¯åˆªé™¤æ•¸é‡**

## **5. ä¸»è¦æŠ€è¡“ç´°ç¯€**

### **ğŸ“Œ 5.1 åœ–ç‰‡ç‰¹å¾µæå–**
- **æ¨¡å‹**ï¼šResNet50 (ç§»é™¤å…¨é€£æ¥å±¤ï¼Œæå– **2048 ç¶­ç‰¹å¾µå‘é‡**)
- **é è™•ç†**ï¼š
  - èª¿æ•´å¤§å°è‡³ `(224, 224)`
  - è½‰æ›ç‚º `Tensor`
  - **æ¨™æº–åŒ– (Normalization)**ï¼š
    ```python
    transforms.Normalize(
        mean=[0.485, 0.456, 0.406],
        std=[0.229, 0.224, 0.225]
    )
    ```

### **ğŸ“Œ 5.2 ç›¸ä¼¼åº¦è¨ˆç®—**
- ä½¿ç”¨ **Cosine Similarity** è¨ˆç®—åœ–ç‰‡ç‰¹å¾µä¹‹é–“çš„ç›¸ä¼¼åº¦ã€‚
- å…¬å¼ï¼š
  $$\text{cosine\_similarity}(A, B) = \frac{A \cdot B}{\|A\| \|B\|}$$
- **ç‰¹å¾µçŸ©é™£è¨ˆç®—ç¯„ä¾‹**ï¼š
  ```python
  norms = np.linalg.norm(features, axis=1, keepdims=True)
  normalized = features / (norms + 1e-10)
  similarity_matrix = np.dot(normalized, normalized.T)
  ```

### **ğŸ“Œ 5.3 Union-Find ç®—æ³• (é€£é€šåˆ†é‡)**
- **ç”¨é€”**ï¼šç¢ºä¿åœ–ç‰‡åªä¿ç•™ä¸€ä»½ï¼Œå»é™¤å¤šé¤˜é‡è¤‡åœ–ç‰‡ã€‚
- **æ–¹æ³•**ï¼š
  ```python
  uf = UnionFind(n_selected)
  for (p1, p2, sim) in duplicates:
      i = path2idx[p1]
      j = path2idx[p2]
      uf.union(i, j)
  ```
- **è¨ˆç®—å¯åˆªé™¤åœ–ç‰‡æ•¸é‡**ï¼š
  ```python
  photos_to_remove = n_selected - uf.count
  ```

## **6. ç¸½çµ**
âœ… **é«˜æ•ˆ ResNet50 åœ–ç‰‡ç‰¹å¾µæå–**ï¼Œé©ç”¨æ–¼å¤§è¦æ¨¡æ•¸æ“šã€‚
âœ… **Cosine Similarity** ç¢ºä¿åœ–ç‰‡ç›¸ä¼¼æ€§è¨ˆç®—æº–ç¢ºã€‚
âœ… **é–¾å€¼å¯èª¿æ•´** (`0.99` é©ç”¨æ–¼éœæ…‹å ´æ™¯ï¼Œå¦‚ CCTV ç›£æ§)ã€‚
âœ… **ç”¢ç”Ÿ JSON å ±å‘Š**ï¼Œæ–¹ä¾¿å¾ŒçºŒæ•¸æ“šåˆ†æèˆ‡è™•ç†ã€‚
âœ… **æ”¯æ´æ‹¼æ¥è¼¸å‡ºç›¸ä¼¼åœ–ç‰‡å°**ï¼Œç›´è§€æŸ¥çœ‹çµæœã€‚

ğŸ“Œ **é©ç”¨å ´æ™¯**ï¼šç›£æ§å½±åƒæ¯”å°ã€æ•¸æ“šé›†æ¨™è¨»æª¢æŸ¥ã€é‡è¤‡åœ–ç‰‡æ¸…ç†ç­‰ã€‚

ğŸš€ è‹¥æœ‰ä»»ä½•å•é¡Œæˆ–æ”¹é€²å»ºè­°ï¼Œè«‹éš¨æ™‚æäº¤ Issue æˆ– Pull Requestï¼

